@(title: String)(content: Html)

<!DOCTYPE html>

<html>
    <head>
        <title>@title</title>

            <!-- Favicon -->
        <link rel="shortcut icon" type="image/png" href="@routes.Assets.at("images/favicon.png")">

            <!-- Static assets -->
        <link rel="stylesheet" media="screen" href="@routes.Assets.at("stylesheets/main.css")">

            <!-- Roboto font from Google -->
        <link href='https://fonts.googleapis.com/css?family=Roboto:400,700' rel='stylesheet' type='text/css'>

            <!-- Bootstrap -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/css/bootstrap.min.css" integrity="sha384-1q8mTJOASx8j1Au+a5WDVnPi2lkFfwwEAa8hDDdjZlpLegxhjVME1fgjWPGmkzs7" crossorigin="anonymous">

            <!-- Font awesome glyphicons -->
        <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css">

            <!-- Google charts loader -->
            <!-- Not sure if Google's cdn is causing the caching errors-->
        <script type="text/javascript" src="@routes.Assets.at("javascripts/googleChartsLoader.js")"></script>
    </head>
    <body>

            <!-- Navbar -->
        <nav class="navbar navbar-inverse" style="border-radius: 0;">
            <div class="container-fluid">
                <div class="navbar-header">
                    <a href="/" class="navbar-brand">Jordan G. Dodson</a>
                </div>

                <div class="collapse navbar-collapse">
                    <ul class="nav navbar-nav">
                        <li><a href="@routes.Assets.at("pdfs/resume.pdf")">Resume</a></li>
                        <li><a href="/about">About</a></li>
                    </ul>
                </div>
            </div>
        </nav>

            <!-- The content of the page. -->
        @content

            <!-- Script that sets up callbacks to draw plots. -->
        <script>

                function loadJSONFile(path, callback) {

                    var httpRequest = new XMLHttpRequest();

                    httpRequest.onreadystatechange = function() {
                        if (httpRequest.readyState === 4) {
                            if (httpRequest.status === 200) {

                                // Parse the response text as JSON
                                var data = JSON.parse(httpRequest.responseText);

                                if (callback) {
                                    callback(data);
                                }
                            }
                        }
                    };
                    httpRequest.open('GET', path);
                    httpRequest.send();
                }


                // Global plot properties
                var titleIsBold = true;
                var titleFontSize = 32;
                var hAxisFontSize = 20;
                var vAxisFontSize = 16;

                // Load the  charts
                google.charts.load('44', {packages: ['line', 'bar', 'timeline']});


                function writeIntroMessage(data, elementId) {

                    var introElem = document.getElementById(elementId);

                    <!-- Should I just do the formatting on the server? -->
                    introElem.querySelector("#startDate").textContent = data.start[0].toString() + "/" + data.start[1].toString() + "/" + data.start[2].toString();
                    introElem.querySelector("#total").textContent = Math.round(data.total).toString();
                    introElem.querySelector("#dailyAverage").textContent = data.dailyAverage.toFixed(2).toString();
                    introElem.querySelector("#daysSinceStart").textContent = data.daysSinceStart.toString();
                    introElem.querySelector("#longestStreak").textContent = data.longestStreak.toString();
                    introElem.querySelector("#currentStreak").textContent = data.currentStreak.toString();
                    introElem.querySelector("#todaysTotal").textContent = data.todaysTotal.toFixed(2).toString();

                }


                function getTodaysSessionsGooglePlotDrawer(plotData, elementId) {

                    function tmp() {
                        var table = new google.visualization.DataTable();

                        var options = {
                            height: 110
                        };

                        // Add columns to the data table
                        plotData.columns.forEach(function(curr, i, arr) {
                            table.addColumn(curr[0], curr[1]);
                        });

                        // Add the rows of data to the data table
                        table.addRows(plotData.rows);

                        var chart = new google.visualization.Timeline(document.getElementById(elementId));

                        chart.draw(table, options);
                    }

                    return tmp;
                }

                function getCumulativeGooglePlotDrawer(plotData, elementId) {

                    var options = {
                        chart: {
                            title: "Cumulative Hours Studied"
                        },
                        legend: {
                            position: 'none'
                        },
                        colors: ['green'],
                        titleTextStyle: {
                            fontSize: titleFontSize,
                            bold: titleIsBold
                        },
                        hAxis: {
                            title: "",
                            textStyle: {
                                fontSize: hAxisFontSize
                            }
                        },
                        vAxis: {
                            textStyle: {
                                fontSize: 20
                            }
                        },
                        // Not working
                        lineWidth: 10,
                        // Not working
                        curveType: 'function'
                    };

                    return getGoogleMaterialPlotDrawer(plotData, options, "Line", elementId);
                }

                function getSubjectCumulativeGooglePlotDrawer(plotData, elementId) {

                    var options = {
                        chart: {
                            title: "Cumulative Hours Studied Per Subject"
                        },
                        titleTextStyle: {
                            fontSize: titleFontSize,
                            bold: titleIsBold
                        },
                        legend: {
                            position: 'none'
                        },
                        hAxis: {
                            title: "",
                            textStyle: {
                                fontSize: hAxisFontSize
                            }
                        },
                        vAxis: {
                            textStyle: {
                                fontSize: 20
                            }
                        },
                        // Not working
                        curveType: 'function'
                    };


                    return getGoogleMaterialPlotDrawer(plotData, options, "Line", elementId);
                }


                // Returns a function that will draw the SubjectTotals plot
                function getSubjectTotalsGooglePlotDrawer(plotData, elementId) {

                    var options = {
                        chart: {
                            title: "Total Hours Studied Per Subject"
                        },
                        titleTextStyle: {
                            fontSize: titleFontSize,
                            bold: titleIsBold
                        },
                        legend: {
                            position: 'none'
                        },
                        hAxis: {
                            title: "",
                            textStyle: {
                                fontSize: hAxisFontSize
                            }
                        },
                        vAxis: {
                            textStyle: {
                                fontSize: 20
                            }
                        },
                        bars: 'vertical',
                        colors: ['green']
                    };

                    return getGoogleMaterialPlotDrawer(plotData, options, "Bar", elementId);
                }


                // Returns a function that will draw the AverageSession plot
                function getAverageSessionGooglePlotDrawer(plotData, elementId) {

                    var options = {
                        chart: {
                            title: "Average Study Session Length Per Subject"
                        },
                        titleTextStyle: {
                            fontSize: titleFontSize,
                            bold: titleIsBold
                        },
                        legend: {
                            position: 'none'
                        },
                        hAxis: {
                            title: "",
                            textStyle: {
                                fontSize: hAxisFontSize
                            },
                            // This is not working
                            slantedText: true
                            // - - - - - - - - - -
                        },
                        vAxis: {
                            textStyle: {
                                fontSize: 20
                            }
                        },
                        bars: 'vertical'
                    };


                    return getGoogleMaterialPlotDrawer(plotData, options, "Bar", elementId);
                }


                function getProbabilityGooglePlotDrawer(plotData, elementId) {

                    var options = {
                        chart: {
                            title: "Probability That I'm Programming"
                        },
                        titleTextStyle: {
                            fontSize: titleFontSize,
                            bold: titleIsBold
                        },
                        legend: {
                            position: 'none'
                        },
                        hAxis: {
                            title: "",
                            textStyle: {
                                fontSize: hAxisFontSize
                            },
                            // The format string is based on ICU pattern set
                            format: "h a"
                        },
                        vAxis: {
                            textStyle: {
                                fontSize: 20
                            }
                        },
                        colors: ['green']
                    };

                    return getGoogleMaterialPlotDrawer(plotData, options, "Line", elementId);
                }


                function getGoogleMaterialPlotDrawer(plotData, plotOptions, plotType, elementId) {

                    function tmp() {
                        var table = new google.visualization.DataTable();

                        // Add columns to the data table
                        plotData.columns.forEach(function(curr, i, arr) {
                            table.addColumn(curr[0], curr[1]);
                        });

                        // Add the rows of data to the data table
                        table.addRows(plotData.rows);

                        var chart = new google.charts[plotType](document.getElementById(elementId));

                        var convertedOptions = google.charts[plotType].convertOptions(plotOptions)

                        chart.draw(table, convertedOptions);
                    }

                    return tmp;
                }

                function convertDates(plotData) {
                    plotData.rows.forEach(function(curr, i, arr) {
                        curr[0] = new Date(curr[0]);
                    });
                }

                // Load the chart data and setup callbacks to plot when we have it.
                loadJSONFile("/stats/1", function(stats) {

                    writeIntroMessage(stats.introMessage, "introMessage");

                    var cumulativeGoogleData = stats.cumulativeGoogle;
                    var rawSubjectCumulativeGoogleData = stats.subjectCumulativeGoogle;

                    // TODO: Debug
                    console.log(stats);

                    convertDates(cumulativeGoogleData);
                    convertDates(rawSubjectCumulativeGoogleData);

                    // Set up call-backs to draw the plots
                    if (stats.todaysSessionsGoogle.rows.length > 0) {
                        google.charts.setOnLoadCallback(getTodaysSessionsGooglePlotDrawer(stats.todaysSessionsGoogle, "todaysSessionsGooglePlot"));
                    }

                    google.charts.setOnLoadCallback(getCumulativeGooglePlotDrawer(stats.cumulativeGoogle, "cumulativeGooglePlot"));
                    google.charts.setOnLoadCallback(getSubjectCumulativeGooglePlotDrawer(rawSubjectCumulativeGoogleData, "subjectCumulativeGooglePlot"));
                    google.charts.setOnLoadCallback(getSubjectTotalsGooglePlotDrawer(stats.subjectTotalsGoogle, "subjectTotalsGooglePlot"));
                    google.charts.setOnLoadCallback(getAverageSessionGooglePlotDrawer(stats.averageSessionGoogle, "averageSessionGooglePlot"));
                    google.charts.setOnLoadCallback(getProbabilityGooglePlotDrawer(stats.probabilityGoogle, "probabilityGooglePlot"));

                })
        </script>
    </body>
</html>
